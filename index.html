<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>SCA ë„ì‹œë½ ì‹œìŠ¤í…œ</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <!-- ì»¤ìŠ¤í…€ í…Œë§ˆ ìŠ¤íƒ€ì¼ -->
    <style>
  :root {
    --color-bg: #f9fafb;
    --color-card: #ffffff;
    --color-primary: #2C3E50;
    --color-accent: #f39c12;
    --color-text: #333;
    --color-border: #dcdcdc;
    --radius: 0.5rem;
    --transition: 0.2s ease;
  }

  *, *::before, *::after { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: 'Roboto', 'Segoe UI', sans-serif;
    background: var(--color-bg);
    color: var(--color-text);
  }

  .container {
    margin-top: 2rem;
    padding: 0 1rem;
  }

  .hidden { display: none !important; }

  /* â”€â”€â”€â”€â”€ Navigation â”€â”€â”€â”€â”€ */
  nav {
    background: var(--color-primary) !important;
    border-bottom: 1px solid #ccc;
    box-shadow: none;
  }

  nav .nav-wrapper {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 56px;
  }

  nav .brand-logo {
    display: flex;
    align-items: center;
    font-weight: 600;
    font-size: 1.25rem;
    color: white !important;
  }

  nav .brand-logo img {
    height: 36px;
    margin-right: 10px;
    background: none;
    padding: 0;
    border-radius: 0;
  }

  nav .brand-logo img:hover {
    transform: scale(1.05);
    transition: transform var(--transition);
  }

  /* â”€â”€â”€â”€â”€ Card â”€â”€â”€â”€â”€ */
  #loginDiv, #empDiv, #adminDiv {
    background: var(--color-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius);
    padding: 1.5rem;
    margin-bottom: 2rem;
  }

  /* â”€â”€â”€â”€â”€ Buttons â”€â”€â”€â”€â”€ */
  .btn {
    border-radius: 6px;
    padding: 0.5rem 1.25rem;
    font-size: 0.95rem;
    font-weight: 500;
    background-color: var(--color-primary) !important;
    color: white !important;
    box-shadow: none;
    transition: background var(--transition), transform var(--transition);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 100px;
  }

  .btn:hover {
    background-color: #1f2e3c !important;
    transform: translateY(-1px);
  }

  .btn.green { background: #27ae60 !important; }
  .btn.amber { background: #ffb300 !important; }

  /* â”€â”€â”€â”€â”€ Inputs â”€â”€â”€â”€â”€ */
  .input-field {
    margin-bottom: 1rem;
  }

  .input-field input,
  .input-field select {
    width: 100%;
    max-width: 280px;
    border: 1px solid var(--color-border);
    border-radius: var(--radius);
    padding: 0.5rem 0.75rem;
    font-size: 0.95rem;
    transition: border-color var(--transition);
  }

  .input-field input::placeholder {
    color: rgba(0, 0, 0, 0.4);
  }

  .input-field input:focus,
  .input-field select:focus {
    border-color: var(--color-primary);
    outline: none;
  }

  /* â”€â”€â”€â”€â”€ Tables â”€â”€â”€â”€â”€ */
  table {
    width: 100%;
    border-collapse: collapse;
    background: var(--color-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius);
    overflow: hidden;
  }

  th, td {
    padding: 0.75rem 1rem;
    text-align: center;
    border-bottom: 1px solid var(--color-border);
  }

  thead {
    background: #f4f6f8;
    font-weight: 600;
  }

  tbody tr:hover {
    background-color: rgba(0, 0, 0, 0.03);
  }

  /* â”€â”€â”€â”€â”€ Calendar â”€â”€â”€â”€â”€ */
  #orderCalendar th {
    background: var(--color-accent);
    color: white;
  }

  #orderCalendar td {
    border: 1px solid var(--color-border);
    transition: background var(--transition);
  }

  #orderCalendar td:hover {
    background: rgba(0, 0, 0, 0.05);
  }

  #orderCalendar .count {
    margin-top: 0.4rem;
    font-size: 0.8rem;
    color: var(--color-primary);
  }

  /* â”€â”€â”€â”€â”€ Footer â”€â”€â”€â”€â”€ */
  footer {
    text-align: center;
    padding: 1rem 0;
    background: #f4f4f4;
    color: var(--color-text);
    font-size: 0.875rem;
  }
  </style>


</head>
<body>


  <nav>
    <div class="nav-wrapper">
  <div class="container">
    <a href="#!" class="brand-logo" style="display: flex; align-items: center; gap: 10px;">
      <img
        src="https://i.ibb.co/shnFdqx/Kakao-Talk-20250520-113526051.png"
        alt="SCA Logo"
        style="height: 100%; max-height: 40px; width: auto;"
      />
      <span style="font-size: 1.2rem;">SCA ë„ì‹œë½</span>
    </a>
        <ul class="right">
          <li>
            <a onclick="onLogout()">
              <i class="material-icons">exit_to_app</i>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>


  <div class="container">
    <!-- ë¡œê·¸ì¸ Card -->
    <div id="loginDiv">
      <h5>ğŸ” ë¡œê·¸ì¸</h5>
      <div class="input-field">
        <input id="loginId" type="text" placeholder="UserID">
      </div>
      <div class="input-field">
        <input id="loginPw" type="password" placeholder="Password">
      </div>
      <!-- ì—¬ê¸° ë²„íŠ¼ì— ìƒ‰ìƒ classë¥¼ ë¶™ì—¬ì£¼ì„¸ìš” -->
      <button class="btn blue" onclick="onLogin()">ë¡œê·¸ì¸</button>
      <p class="red-text" id="loginMsg"></p>
    </div>

    <!-- ì§ì› í™”ë©´ -->
    <div id="empDiv" class="hidden">
      <h5>ğŸ“ ì§ì› ì£¼ë¬¸ í™”ë©´</h5>
      <p>ì•ˆë…•í•˜ì„¸ìš”, <strong id="empName"></strong>ë‹˜</p>

      <div class="row">
        <div class="input-field col s6">
          <input id="empOrderDate" type="date">
          <label for="empOrderDate" class="active">ì£¼ë¬¸ ë‚ ì§œ</label>
        </div>
        <div class="input-field col s6">
          <select id="empVendor"><option disabled selected>ì—…ì²´ ì„ íƒ</option></select>
          <label>ë„ì‹œë½ ì—…ì²´</label>
        </div>
        <div class="col s6 valign-wrapper">
          <button id="empBtn" class="btn waves-effect waves-light">ì£¼ë¬¸í•˜ê¸°</button>
        </div>
      </div>

      <h6>ì›”ë³„ ì£¼ë¬¸ ë‚´ì—­</h6>
      <div class="row">
        <div class="input-field col s6">
          <input id="monthPicker" type="month">
          <label for="monthPicker" class="active">ì›” ì„ íƒ</label>
        </div>
        <div class="col s6">
          <button class="btn" onclick="loadByMonth()">ì¡°íšŒ</button>
        </div>
      </div>

      <table class="highlight">
        <thead>
          <tr><th>ë‚ ì§œ</th><th>UserID</th><th>ìƒíƒœ</th><th>ì•¡ì…˜</th></tr>
        </thead>
        <tbody id="ordersContainer"></tbody>
      </table>
    </div>

    <!-- ê´€ë¦¬ì í™”ë©´ -->
    <div id="adminDiv" class="hidden">
      <h5>ğŸ”§ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h5>
      <p>ì•ˆë…•í•˜ì„¸ìš”, ê´€ë¦¬ì <strong id="adminName"></strong>ë‹˜</p>
      <ul class="collapsible">

        <!-- ì „ì²´ ì£¼ë¬¸ ì¡°íšŒ -->
<li>
  <div class="collapsible-header"><i class="material-icons">shopping_cart</i>ì „ì²´ ì£¼ë¬¸ ì¡°íšŒ</div>
  <div class="collapsible-body">
    <div class="input-field">
      <input id="filterName" type="text"><label for="filterName">Name ê²€ìƒ‰</label>
    </div>
    <div class="input-field">
      <input id="startDate" type="date"><label for="startDate">ì‹œì‘ì¼</label>
    </div>
    <div class="input-field">
      <input id="endDate" type="date"><label for="endDate">ì¢…ë£Œì¼</label>
    </div>
    <button class="btn" onclick="loadAll()">ì¡°íšŒ</button>
    <!-- CSV ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ -->
    <button class="btn green" style="margin-left:8px" onclick="downloadCSV()">ë‹¤ìš´ : ì›ë³¸</button>
    <button class="btn blue" style="margin-left:8px" onclick="downloadSummaryCSV()">ë‹¤ìš´ : ìš”ì•½</button>
    <table class="highlight" style="margin-top:16px">
      <thead>
        <tr><th>ë‚ ì§œ</th><th>Name</th><th>ìƒíƒœ</th><th>ì•¡ì…˜</th></tr>
      </thead>
      <tbody id="adminContainer"></tbody>
    </table>
  </div>
</li>


        <!-- 3) ì¼ê´„ ì£¼ë¬¸ -->
        <li>
          <div class="collapsible-header"><i class="material-icons">group_add</i>ì§ì› ì¼ê´„ ì£¼ë¬¸</div>
          <div class="collapsible-body">
            <div class="input-field">
              <input id="bulkDate" type="date"><label for="bulkDate">ë‚ ì§œ</label>
            </div>
            <div class="input-field">
              <select multiple id="employeeSelect"><option disabled>ì§ì› ì„ íƒ</option></select>
              <label>ì§ì› ì„ íƒ</label>
            </div>
            <button class="btn" onclick="bulkOrder()">ì¼ê´„ ì£¼ë¬¸</button>
            <p id="bulkMsg" class="green-text"></p>
          </div>
        </li>

        <!-- 4) ì˜¤ëŠ˜ ì£¼ë¬¸ ê±´ìˆ˜ -->
        <li>
          <div class="collapsible-header"><i class="material-icons">assessment</i>ì˜¤ëŠ˜ ì£¼ë¬¸ ê±´ìˆ˜</div>
          <div class="collapsible-body">
            <p>ì˜¤ëŠ˜ ì£¼ë¬¸ ìˆ˜ëŸ‰: <strong id="todayCount">0</strong> ê±´</p>
            <button class="btn" onclick="loadTodayCount()">ìƒˆë¡œê³ ì¹¨</button>
            <table class="highlight" style="margin-top:12px;">
              <thead><tr><th>VendorID</th><th>Name</th><th>Count</th></tr></thead>
              <tbody id="vendorTodayBody"></tbody>
            </table>
          </div>
        </li>

        <!-- 4-1) ì—…ì²´ë³„ ì§‘ê³„ -->
        <li>
          <div class="collapsible-header"><i class="material-icons">storefront</i>ì—…ì²´ë³„ ì§‘ê³„</div>
          <div class="collapsible-body">
            <div class="row">
              <div class="input-field col s4">
                <input id="vendorStart" type="date"><label for="vendorStart">ì‹œì‘ì¼</label>
              </div>
              <div class="input-field col s4">
                <input id="vendorEnd" type="date"><label for="vendorEnd">ì¢…ë£Œì¼</label>
              </div>
              <div class="input-field col s4">
                <select id="vendorFilter"><option value="">ì „ì²´ ë²¤ë”</option></select>
                <label>ë²¤ë” ì„ íƒ(ì„ íƒ ì‹œ ì‚¬ìš©ìë³„ ìƒì„¸)</label>
              </div>
            </div>
            <div class="row">
              <button class="btn" onclick="loadVendorSummary()">ì¡°íšŒ</button>
              <button class="btn green" style="margin-left:8px" onclick="downloadVendorCSV()">CSV</button>
              <button class="btn amber" style="margin-left:8px" onclick="downloadUserVendorCSV()">ì‚¬ìš©ì-ì—…ì²´ CSV</button>
              <button class="btn" style="margin-left:8px" onclick="downloadUserVendorPivotCSV()">ì‚¬ìš©ìë³„ ì—…ì²´ í”¼ë²— CSV</button>
            </div>
            <table class="highlight" style="margin-top:12px;">
              <thead id="vendorSummaryHead"></thead>
              <tbody id="vendorSummaryBody"></tbody>
            </table>
          </div>
        </li>

        <!-- 5) ì§ì› ê³„ì • ê´€ë¦¬ -->
        <li>
          <div class="collapsible-header"><i class="material-icons">person</i>ì§ì› ê³„ì • ê´€ë¦¬</div>
          <div class="collapsible-body">
            <form id="addForm">
              <div class="input-field">
                <input id="newId" type="text"><label for="newId">UserID</label>
              </div>
              <div class="input-field">
                <input id="newName" type="text"><label for="newName">Name</label>
              </div>
              <div class="input-field">
                <input id="newPw" type="password"><label for="newPw">Password</label>
              </div>
              <div class="input-field">
                <select id="newRole">
                  <option value="employee">employee</option>
                  <option value="admin">admin</option>
                </select>
                <label>Role</label>
              </div>
              <button class="btn" type="submit">ì§ì› ì¶”ê°€</button>
            </form>
            <table class="highlight">
              <thead><tr><th>UserID</th><th>Name</th><th>Role</th><th>ì•¡ì…˜</th></tr></thead>
              <tbody id="empList"></tbody>
            </table>
          </div>
        </li>

        <!-- 5-1) ë„ì‹œë½ ì—…ì²´ ê´€ë¦¬ -->
        <li>
          <div class="collapsible-header"><i class="material-icons">store</i>ë„ì‹œë½ ì—…ì²´ ê´€ë¦¬</div>
          <div class="collapsible-body">
            <div class="row">
              <div class="input-field col s8 m6">
                <input id="vendorName" type="text"><label for="vendorName">ì—…ì²´ëª…</label>
              </div>
              <div class="col s4 m6 valign-wrapper" style="margin-top:12px;">
                <button class="btn" onclick="addVendorUI()">ì—…ì²´ ì¶”ê°€</button>
              </div>
            </div>
            <table class="highlight" style="margin-top:8px;">
              <thead><tr><th>VendorID</th><th>Name</th><th>ì•¡ì…˜</th></tr></thead>
              <tbody id="vendorList"></tbody>
            </table>
          </div>
        </li>

        <!-- 6) ë‹¬ë ¥ ì£¼ë¬¸ í˜„í™© -->
        <li>
          <div class="collapsible-header"><i class="material-icons">calendar_today</i>ë‹¬ë ¥ ì£¼ë¬¸ í˜„í™©</div>
          <div class="collapsible-body">
            <div class="row">
              <div class="input-field col s6">
                <input id="calendarMonth" type="month">
                <label for="calendarMonth" class="active">ì›” ì„ íƒ</label>
              </div>
              <div class="col s6 valign-wrapper">
                <button class="btn" onclick="loadCalendar()">ë¶ˆëŸ¬ì˜¤ê¸°</button>
              </div>
            </div>
            <div id="orderCalendar"></div>
          </div>
        </li>

      </ul>
    </div>

  </div>


 <!-- í‘¸í„° -->
<footer>
  <div class="container">
    Created by Yeulyee Kim
  </div>
</footer>


  <!-- Materialize JS -->
 <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', ()=>{ M.AutoInit(); });

    let currentUser = null;

    // ë¡œê·¸ì•„ì›ƒ: í•­ìƒ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ë³µê·€
  function onLogout() {
    // ì„¸ì…˜ ì‚¬ìš©ì ì •ë³´ ì‚­ì œ
    currentUser = null;

    // ë¡œê·¸ì¸ í™”ë©´ ë³´ì´ê¸°
    document.getElementById('loginDiv').classList.remove('hidden');

    // ì§ì›/ê´€ë¦¬ì í™”ë©´ ìˆ¨ê¸°ê¸°
    document.getElementById('empDiv').classList.add('hidden');
    document.getElementById('adminDiv').classList.add('hidden');

    // ë¡œê·¸ì¸ í¼ ì´ˆê¸°í™”
    document.getElementById('loginId').value = '';
    document.getElementById('loginPw').value = '';
    document.getElementById('loginMsg').textContent = '';

    // Materialize í¼ ìƒíƒœ ë¦¬ì…‹
    M.updateTextFields();
  }

    // ë¡œê·¸ì¸
    function onLogin() {
      const id = document.getElementById('loginId').value;
      const pw = document.getElementById('loginPw').value;
      google.script.run
        .withSuccessHandler(handleLogin)
        .withFailureHandler(e=>M.toast({html:e.message}))
        .authenticateUser(id,pw);
    }
    function handleLogin(res) {
      if (!res) {
        document.getElementById('loginMsg').textContent = 'ë¡œê·¸ì¸ ì‹¤íŒ¨';
        return;
      }
      currentUser = res;
      document.getElementById('loginDiv').classList.add('hidden');
      if (res.role === 'employee') {
        document.getElementById('empName').textContent = res.name;
        document.getElementById('empDiv').classList.remove('hidden');
        M.updateTextFields();
        initEmployee();
      } else {
        document.getElementById('adminName').textContent = res.name;
        document.getElementById('adminDiv').classList.remove('hidden');
        M.updateTextFields();
        initAdmin();
      }
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì§ì› ì´ˆê¸°í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function initEmployee() {
      const today = new Date().toISOString().slice(0,10);
      document.getElementById('empOrderDate').value = today;
      document.getElementById('monthPicker').value   = today.substr(0,7);
      M.updateTextFields();

      updateEmpButton(today);
      loadByMonth();
      loadVendorsForEmp();
      document.getElementById('empOrderDate')
        .addEventListener('change', e => updateEmpButton(e.target.value));
      // ì§ì› í™”ë©´: ë²¤ë” ë³€ê²½ ì‹œ ìµœê·¼ ì„ íƒ ì €ì¥
      const sel = document.getElementById('empVendor');
      sel.addEventListener('change', () => {
        if (!currentUser) return;
        const key = `lastVendor_${currentUser.userId}`;
        const val = sel.value || '';
        try { localStorage.setItem(key, val); } catch (e) {}
      });
    }
    function updateEmpButton(date) {
      google.script.run
        .withSuccessHandler(list => {
          const btn = document.getElementById('empBtn');
          const has = list.some(o=>o.Status==='ordered');
          btn.textContent = has ? 'ì·¨ì†Œí•˜ê¸°' : 'ì£¼ë¬¸í•˜ê¸°';
          btn.onclick     = has ? ()=>cancelEmpOrder(date) : ()=>orderEmp(date);
        })
        .getMyOrdersInRange(date,date,currentUser.userId);
    }
    // ì£¼ë¬¸í•˜ê¸°
function orderEmp(date) {
  // Optimistic UI: ë²„íŠ¼ ì¦‰ì‹œ ë°˜ì˜ ë° ë¹„í™œì„±í™”
  const btn = document.getElementById('empBtn');
  btn.textContent = 'ì·¨ì†Œí•˜ê¸°';
  btn.onclick     = null;
  btn.disabled    = true;
  M.toast({html:'ì£¼ë¬¸ ì²˜ë¦¬ ì¤‘...'});
  // ë²¤ë” ì„ íƒ í™•ì¸
  const sel = document.getElementById('empVendor');
  const vendorId = sel && sel.value;
  if (!vendorId || sel.selectedIndex === 0) {
    btn.disabled = false;
    updateEmpButton(date);
    return M.toast({html:'ì—…ì²´ë¥¼ ì„ íƒí•˜ì„¸ìš”'});
  }
  // ì„œë²„ í˜¸ì¶œ
  google.script.run
    .withSuccessHandler(res => {
      M.toast({html:'ì£¼ë¬¸ë˜ì—ˆìŠµë‹ˆë‹¤'});
      btn.disabled = false;
      loadByMonth();
    })
    .withFailureHandler(e => {
      M.toast({html:e.message});
      btn.disabled = false;
      loadByMonth();
    })
    .placeOrderWithVendor(date, currentUser.userId, vendorId);
  // ìµœê·¼ ì„ íƒí•œ ë²¤ë” ì €ì¥
  try { if (currentUser) localStorage.setItem(`lastVendor_${currentUser.userId}`, vendorId); } catch (e) {}
}

    // ì·¨ì†Œí•˜ê¸°
function cancelEmpOrder(date) {
  // Optimistic UI: ë²„íŠ¼ ì¦‰ì‹œ ë°˜ì˜ ë° ë¹„í™œì„±í™”
  const btn = document.getElementById('empBtn');
  btn.textContent = 'ì£¼ë¬¸í•˜ê¸°';
  btn.onclick     = null;
  btn.disabled    = true;
  M.toast({html:'ì·¨ì†Œ ì²˜ë¦¬ ì¤‘...'});
  // ì„œë²„ í˜¸ì¶œ
  google.script.run
    .withSuccessHandler(res => {
      M.toast({html:'ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤'});
      btn.disabled = false;
      loadByMonth();
    })
    .withFailureHandler(e => {
      M.toast({html:e.message});
      btn.disabled = false;
      loadByMonth();
    })
    .cancelOrder(date, currentUser.userId);
}
    function loadByMonth() {
      const ym = document.getElementById('monthPicker').value;
      if (!ym) return;
      const [y,m] = ym.split('-');
      const start = `${ym}-01`;
      const end   = new Date(y,m,0).toISOString().slice(0,10);
      google.script.run
        .withSuccessHandler(ords => {
          const tb = document.getElementById('ordersContainer');
          tb.innerHTML = '';
          if (!ords.length) {
            tb.innerHTML = '<tr><td colspan="4">ì£¼ë¬¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
      return;
    }
          const today = new Date().toISOString().slice(0,10);
          ords.forEach(o => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${o.Date}</td>
              <td>${o.UserID}</td>
              <td>${o.Status==='ordered'?'ì£¼ë¬¸':'ì·¨ì†Œ'}</td>
              <td>${
                o.Status==='ordered' && o.Date>=today
                  ? `<button class="btn-flat red-text" onclick="cancelEmpOrder('${o.Date}')">ì·¨ì†Œ</button>`
                  : ''
              }</td>`;
            tb.appendChild(tr);
          });
        })
        .getMyOrdersInRange(start,end,currentUser.userId);
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ê´€ë¦¬ì ì´ˆê¸°í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        function initAdmin() {
      const today = new Date().toISOString().slice(0,10);
      // ë‚ ì§œ ê´€ë ¨ í•„ë“œë§Œ ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì´ˆê¸°í™” (cutoffDate ì œê±°)
      ['startDate','endDate','bulkDate','calendarMonth']
        .forEach(id => {
          const el = document.getElementById(id);
          if (el) el.value = today;
        });
      // ì—…ì²´ ì§‘ê³„ ê¸°ë³¸ ë‚ ì§œ
      ['vendorStart','vendorEnd'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.value = today;
      });
      // Name ê²€ìƒ‰ í•„ë“œëŠ” ë¹ˆ ê°’ìœ¼ë¡œ ì´ˆê¸°í™”
      document.getElementById('filterName').value = '';
      M.updateTextFields();
      loadAll();
      loadEmployees();
      loadTodayCount();
      loadCalendar();
      loadVendors();
      loadVendorsForSummary();
      document.getElementById('bulkDate')
        .addEventListener('change', loadEmployees);
    }


    function loadAll() {
      const s = document.getElementById('startDate').value;
      const e = document.getElementById('endDate').value;
      const nameFilter = document.getElementById('filterName').value.trim();
      google.script.run
        .withSuccessHandler(data=>{
          const tb = document.getElementById('adminContainer');
          tb.innerHTML = '';
          if (!data.length) {
            tb.innerHTML = '<tr><td colspan="4">ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
      return;
    }
          data.forEach(o=>{
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${o.Date}</td>
              <td>${o.Name}</td>
              <td>${o.Status==='ordered'?'ì£¼ë¬¸':'ì·¨ì†Œ'}</td>
              <td>
                ${o.Status==='ordered'
                  ? `<button class="btn-flat red-text" onclick="cancelAdminOrder('${o.Date}','${o.UserID}')">ì·¨ì†Œ</button>`
                  : ''}
              </td>`;
            tb.appendChild(tr);
          });
        })
        .getAllOrdersFiltered(s, e, nameFilter);
    }
    function loadEmployees() {
      google.script.run
        .withSuccessHandler(list=>{
          const sel = document.getElementById('employeeSelect');
          sel.innerHTML = '<option disabled>ì§ì› ì„ íƒ</option>';
          list.forEach(u=>{
            const opt = document.createElement('option');
            opt.value = u.userId; opt.text = `${u.name}(${u.userId})`;
            sel.appendChild(opt);
          });
          M.FormSelect.init(sel);
        })
        .getEmployees();
    }

    // ì§ì› í™”ë©´ìš©: ì—…ì²´ ëª©ë¡ ë¡œë“œ
    function loadVendorsForEmp() {
      const sel = document.getElementById('empVendor');
      if (!sel) return;
      // ì¬ì´ˆê¸°í™”ë¥¼ ìœ„í•´ ê¸°ì¡´ ì¸ìŠ¤í„´ìŠ¤ ì œê±°
      try { const inst = M.FormSelect.getInstance(sel); if (inst) inst.destroy(); } catch (e) {}
      google.script.run
        .withSuccessHandler(list => {
          sel.innerHTML = '<option disabled selected>ì—…ì²´ ì„ íƒ</option>';
          (list||[]).forEach(v => {
            const opt = document.createElement('option');
            opt.value = v.vendorId;
            opt.text  = `${v.name} (${v.vendorId})`;
            sel.appendChild(opt);
          });
          M.FormSelect.init(sel);
          if (!list || !list.length) {
            M.toast({html:'ë“±ë¡ëœ ì—…ì²´ê°€ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ì„œ ì—…ì²´ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.'});
          }
          // ìµœê·¼ ì„ íƒí•œ ë²¤ë” ìë™ ì„ íƒ
          if (currentUser) {
            const key = `lastVendor_${currentUser.userId}`;
            let last = '';
            try { last = localStorage.getItem(key) || ''; } catch (e) {}
            if (last) {
              const found = Array.from(sel.options).some(o => o.value === last);
              if (found) {
                sel.value = last;
                // ê°’ ë³€ê²½ í›„ ì¬ì´ˆê¸°í™”
                try { const inst2 = M.FormSelect.getInstance(sel); if (inst2) inst2.destroy(); } catch (e) {}
                M.FormSelect.init(sel);
              }
            }
          }
        })
        .getVendors();
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì—…ì²´ ê´€ë¦¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function loadVendors() {
      google.script.run
        .withSuccessHandler(list => {
          const tb = document.getElementById('vendorList');
          tb.innerHTML = '';
          if (!list || !list.length) {
            tb.innerHTML = '<tr><td colspan="3">ë“±ë¡ëœ ì—…ì²´ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            return;
          }
          list.forEach(v => {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${v.vendorId}</td><td>${v.name}</td>
                            <td>
                              <button class="btn amber" onclick="editVendor('${v.vendorId}','${v.name.replace(/'/g,"\\'")}')">ìˆ˜ì •</button>
                              <button class="btn red" style="margin-left:6px" onclick="deleteVendorUI('${v.vendorId}')">ì‚­ì œ</button>
                            </td>`;
            tb.appendChild(tr);
          });
        })
        .getVendors();
    }
    function loadVendorsForSummary() {
      const sel = document.getElementById('vendorFilter');
      if (!sel) return;
      google.script.run
        .withSuccessHandler(list => {
          sel.innerHTML = '<option value="">ì „ì²´ ë²¤ë”</option>';
          (list||[]).forEach(v => {
            const opt = document.createElement('option');
            opt.value = v.vendorId;
            opt.text  = `${v.name} (${v.vendorId})`;
            sel.appendChild(opt);
          });
          M.FormSelect.init(sel);
        })
        .getVendors();
    }

    function loadVendorSummary() {
      const s = document.getElementById('vendorStart').value;
      const e = document.getElementById('vendorEnd').value;
      const vid = document.getElementById('vendorFilter').value;
      const head = document.getElementById('vendorSummaryHead');
      const body = document.getElementById('vendorSummaryBody');
      body.innerHTML = '';
      if (!vid) {
        // ì „ì²´ ë²¤ë” ì§‘ê³„
        google.script.run
          .withSuccessHandler(rows => {
            head.innerHTML = '<tr><th>VendorID</th><th>Name</th><th>Count</th></tr>';
            if (!rows || !rows.length) { body.innerHTML = '<tr><td colspan="3">ë°ì´í„° ì—†ìŒ</td></tr>'; return; }
            rows.forEach(r => {
              const tr = document.createElement('tr');
              tr.innerHTML = `<td>${r.VendorID}</td><td>${r.VendorName}</td><td>${r.Count}</td>`;
              body.appendChild(tr);
            });
          })
          .getVendorCountsForRange(s, e);
      } else {
        // íŠ¹ì • ë²¤ë” ì‚¬ìš©ìë³„ ìƒì„¸
        google.script.run
          .withSuccessHandler(rows => {
            head.innerHTML = '<tr><th>UserID</th><th>Name</th><th>Count</th></tr>';
            if (!rows || !rows.length) { body.innerHTML = '<tr><td colspan="3">ë°ì´í„° ì—†ìŒ</td></tr>'; return; }
            rows.forEach(r => {
              const tr = document.createElement('tr');
              tr.innerHTML = `<td>${r.UserID}</td><td>${r.Name}</td><td>${r.Count}</td>`;
              body.appendChild(tr);
            });
          })
          .getVendorUserCountsForRange(s, e, vid);
      }
    }

    function downloadVendorCSV() {
      const s = document.getElementById('vendorStart').value;
      const e = document.getElementById('vendorEnd').value;
      const vid = document.getElementById('vendorFilter').value;
      if (!vid) {
        google.script.run.withSuccessHandler(rows => {
          if (!rows || !rows.length) { return M.toast({html:'ë°ì´í„° ì—†ìŒ'}); }
          const header = ['VendorID','Name','Count'];
          let csv = '\uFEFF' + header.join(',') + '\r\n';
          rows.forEach(r => { csv += [`"${r.VendorID}"`,`"${r.VendorName}"`,r.Count].join(',') + '\r\n'; });
          const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
          const url  = URL.createObjectURL(blob);
          const a = document.createElement('a'); a.href = url; a.download = `vendor_counts_${s}_to_${e}.csv`; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
        }).getVendorCountsForRange(s,e);
      } else {
        google.script.run.withSuccessHandler(rows => {
          if (!rows || !rows.length) { return M.toast({html:'ë°ì´í„° ì—†ìŒ'}); }
          const header = ['UserID','Name','Count'];
          let csv = '\uFEFF' + header.join(',') + '\r\n';
          rows.forEach(r => { csv += [`"${r.UserID}"`,`"${r.Name}"`,r.Count].join(',') + '\r\n'; });
          const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
          const url  = URL.createObjectURL(blob);
          const a = document.createElement('a'); a.href = url; a.download = `vendor_${vid}_users_${s}_to_${e}.csv`; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
        }).getVendorUserCountsForRange(s,e,vid);
      }
    }

    function downloadUserVendorCSV() {
      const s = document.getElementById('vendorStart').value;
      const e = document.getElementById('vendorEnd').value;
      google.script.run.withSuccessHandler(rows => {
        if (!rows || !rows.length) { return M.toast({html:'ë°ì´í„° ì—†ìŒ'}); }
        const header = ['UserID','Name','VendorID','VendorName','Count'];
        let csv = '\uFEFF' + header.join(',') + '\r\n';
        rows.forEach(r => {
          csv += [r.UserID, r.Name, r.VendorID, r.VendorName, r.Count]
            .map(v => '"' + String(v).replace(/"/g,'""') + '"')
            .join(',') + '\r\n';
        });
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const url  = URL.createObjectURL(blob);
        const a    = document.createElement('a');
        a.href = url; a.download = `user_vendor_${s}_to_${e}.csv`;
        document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
      }).getUserVendorCountsForRange(s, e);
    }

    function downloadUserVendorPivotCSV() {
      const s = document.getElementById('vendorStart').value;
      const e = document.getElementById('vendorEnd').value;
      google.script.run
        .withSuccessHandler(res => {
          if (!res || !res.header || !res.rows) { return M.toast({html:'ë°ì´í„° ì—†ìŒ'}); }
          const header = res.header;
          const rows   = res.rows;
          let csv = '\uFEFF' + header.join(',') + '\r\n';
          rows.forEach(r => {
            csv += r.map(v => '"' + String(v).replace(/"/g,'""') + '"').join(',') + '\r\n';
          });
          const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
          const url  = URL.createObjectURL(blob);
          const a    = document.createElement('a');
          a.href = url; a.download = `user_vendor_pivot_${s}_to_${e}.csv`;
          document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
        })
        .getUserVendorPivotForRange(s, e);
    }
    function addVendorUI() {
      const name = document.getElementById('vendorName').value.trim();
      if (!name) { return M.toast({html:'ì—…ì²´ëª…ì„ ì…ë ¥í•˜ì„¸ìš”'}); }
      google.script.run
        .withSuccessHandler(() => {
          M.toast({html:'ì—…ì²´ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤'});
          document.getElementById('vendorName').value = '';
          M.updateTextFields();
          loadVendors();
        })
        .withFailureHandler(err => M.toast({html: err.message}))
        .addVendorAuto(name);
    }

    function editVendor(vendorId, currentName) {
      const newName = prompt(`ì—…ì²´ëª… ìˆ˜ì • (${vendorId})`, currentName || '');
      if (newName == null) return; // ì·¨ì†Œ
      const trimmed = newName.trim();
      if (!trimmed) return M.toast({html:'ì—…ì²´ëª…ì„ ì…ë ¥í•˜ì„¸ìš”'});
      google.script.run
        .withSuccessHandler(()=>{ M.toast({html:'ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤'}); loadVendors(); })
        .withFailureHandler(err=> M.toast({html: err.message}))
        .updateVendorName(vendorId, trimmed);
    }

    function deleteVendorUI(vendorId) {
      if (!confirm(`ì—…ì²´(${vendorId})ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
      google.script.run
        .withSuccessHandler(()=>{ M.toast({html:'ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤'}); loadVendors(); })
        .withFailureHandler(err=>{
          // ì°¸ì¡° ì˜¤ë¥˜ì¸ ê²½ìš° ê°•ì œ ì‚­ì œ í™•ì¸
          const msg = err && err.message ? err.message : String(err);
          if (msg.indexOf('ì°¸ì¡°í•˜ëŠ” ì£¼ë¬¸') !== -1) {
            if (confirm('í•´ë‹¹ ì—…ì²´ë¥¼ ì°¸ì¡°í•˜ëŠ” ì£¼ë¬¸ì´ ìˆìŠµë‹ˆë‹¤. ë§¤í•‘ì„ í•¨ê»˜ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
              google.script.run
                .withSuccessHandler(()=>{ M.toast({html:'ê°•ì œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤'}); loadVendors(); })
                .withFailureHandler(e2=> M.toast({html: e2.message}))
                .deleteVendor(vendorId, true);
            }
          } else {
            M.toast({html: msg});
          }
        })
        .deleteVendor(vendorId, false);
    }
    function bulkOrder() {
      const date = document.getElementById('bulkDate').value;
      const sel  = document.getElementById('employeeSelect');
      const ids  = Array.from(sel.selectedOptions).map(o=>o.value);
      google.script.run
        .withSuccessHandler(res=>{
          const ok = res.filter(r=>r.success).length;
          M.toast({html:`${ok}ê±´ ì£¼ë¬¸ ì²˜ë¦¬`});
          loadTodayCount();
        })
        .bulkPlaceOrder(date,ids);
    }
    function loadTodayCount() {
      const today = new Date().toISOString().slice(0,10);
      google.script.run
        .withSuccessHandler(res => {
          document.getElementById('todayCount').textContent = (res && res.total) || 0;
          const tb = document.getElementById('vendorTodayBody');
          tb.innerHTML = '';
          const rows = (res && res.vendors) || [];
          if (!rows.length) {
            tb.innerHTML = '<tr><td colspan="3">ë°ì´í„° ì—†ìŒ</td></tr>';
            return;
          }
          rows.forEach(r => {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${r.VendorID}</td><td>${r.VendorName}</td><td>${r.Count}</td>`;
            tb.appendChild(tr);
          });
        })
        .getTodayOverview(today);
    }



function downloadCSV() {
  const s = document.getElementById('startDate').value;
  const e = document.getElementById('endDate').value;
  const nameFilter = document.getElementById('filterName').value.trim();

  // 1ï¸âƒ£ ìš”ì•½ ì‹œíŠ¸(â€œSummaryâ€) ìƒì„±/ê°±ì‹ 
  google.script.run
    .withSuccessHandler(function() {
      // 2ï¸âƒ£ ê°±ì‹ ì´ ëë‚˜ë©´ ê¸°ì¡´ CSV ë‹¤ìš´ë¡œë“œ ë¡œì§ ì‹¤í–‰
      google.script.run
        .withSuccessHandler(function(data) {
          if (!data.length) {
            return M.toast({html:'ë‹¤ìš´ë¡œë“œí•  ì£¼ë¬¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'});
          }
          const header = ['ë‚ ì§œ','Name','ìƒíƒœ'];
          const rows   = data.map(o=>[
            o.Date,
            o.Name,
            o.Status==='ordered' ? 'ì£¼ë¬¸' : 'ì·¨ì†Œ'
          ]);

          // CSV ë¬¸ìì—´ ë§Œë“¤ê¸° (UTF-8 BOM í¬í•¨)
          let csv = '\uFEFF' + header.join(',') + '\r\n';
          rows.forEach(r=>{
            csv += r.map(v => `"${v.replace(/"/g,'""')}"`).join(',') + '\r\n';
          });

          const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
          const url  = URL.createObjectURL(blob);
          const a    = document.createElement('a');
          a.href     = url;
          a.download = `orders_${s}_to_${e}.csv`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        })
        .getAllOrdersFiltered(s, e, nameFilter);
    })
    .createOrderSummarySheet();  // Summary ì‹œíŠ¸ ê°±ì‹  í˜¸ì¶œ
}

  function downloadSummaryCSV() {
    // ì„œë²„ì—ì„œ ìš”ì•½ ë°ì´í„°(JSON) ë°›ì•„ì˜¤ê¸°
    google.script.run
      .withSuccessHandler(function(data) {
        if (!data.length) {
          return M.toast({html:'ë‹¤ìš´ë¡œë“œí•  ìš”ì•½ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'});
        }
        // í—¤ë”
        const header = ['UserID','Name','Count'];
        // CSV ë¬¸ìì—´ (UTF-8 BOM í¬í•¨)
        let csv = '\uFEFF' + header.join(',') + '\r\n';
        data.forEach(row => {
          csv += [
            row.UserID,
            row.Name,
            row.Count
          ].map(v => `"${String(v).replace(/"/g,'""')}"`)
           .join(',') + '\r\n';
        });

        // Blob ìƒì„± â†’ ë‹¤ìš´ë¡œë“œ
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const url  = URL.createObjectURL(blob);
        const a    = document.createElement('a');
        a.href     = url;
        a.download = `order_summary.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      })
      .getOrderSummary();  // â† ìƒˆë¡œ ë§Œë“  ì„œë²„ í•¨ìˆ˜ í˜¸ì¶œ
  }


    // ê´€ë¦¬ì ë‹¬ë ¥ ë°ì´í„° ë¡œë“œ
    function loadCalendar() {
      const ym = document.getElementById('calendarMonth').value;
      if (!ym) return;
      const [y,m] = ym.split('-');
      const start = `${ym}-01`;
      const end   = new Date(y, m, 0).toISOString().slice(0,10);
      google.script.run
        .withSuccessHandler(drawCalendar)
        .getOrderCountsForRange(start, end);
    }
    function drawCalendar(data) {
      const ym = document.getElementById('calendarMonth').value;
      const [y,m] = ym.split('-');
      const first = new Date(y, m-1, 1);
      const lastDay = new Date(y, m, 0).getDate();
      const startWeek = first.getDay();
      const countMap = {};
      data.forEach(o=> countMap[o.date] = o.count);

      let html = '<table><thead><tr>'
        + ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '].map(d=>`<th>${d}</th>`).join('')
        + '</tr></thead><tbody><tr>';
      for (let i=0; i<startWeek; i++) html += '<td></td>';
      for (let day=1; day<=lastDay; day++) {
        const ds = `${ym}-${String(day).padStart(2,'0')}`;
        const cnt = countMap[ds]||0;
        html += `<td><div>${day}</div><div class="count">${cnt}ê±´</div></td>`;
        if ((startWeek + day) % 7 === 0 && day!==lastDay) html += '</tr><tr>';
      }
      const tail = (startWeek + lastDay) % 7;
      if (tail !== 0) for (let i=tail; i<7; i++) html += '<td></td>';
      html += '</tr></tbody></table>';
      document.getElementById('orderCalendar').innerHTML = html;
    }

    function cancelAdminOrder(date, userId) {
      google.script.run
        .withSuccessHandler(()=>{
          M.toast({html:'ê´€ë¦¬ì ì·¨ì†Œ ì™„ë£Œ'});
          loadAll();
          loadCalendar();
          loadTodayCount();
        })
        .withFailureHandler(e=>M.toast({html:e.message}))
        .adminCancelOrder(date, userId);
    }

    // ì§ì› ê³„ì • ë¦¬ìŠ¤íŠ¸ ë¡œë“œ
    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
  // ì§ì› ëª©ë¡ UI ì „ì²´ ê°±ì‹  í•¨ìˆ˜
  // ë¦¬ìŠ¤íŠ¸(list)ë¥¼ ë°›ì•„ì„œ <select>ì™€ <table>ì„ ë™ì‹œì— ì—…ë°ì´íŠ¸
  function updateEmployeeUI(list) {
    // 1) ì§ì› ì„ íƒìš© select ì¬êµ¬ì„±
    const sel = document.getElementById('employeeSelect');
    sel.innerHTML = '<option disabled>ì§ì› ì„ íƒ</option>';
    list.forEach(u => {
      const opt = document.createElement('option');
      opt.value = u.userId;
      opt.text  = `${u.name} (${u.userId})`;
      sel.appendChild(opt);
    });
    M.FormSelect.init(sel);

    // 2) ì§ì› í…Œì´ë¸” ì¬êµ¬ì„±
    const tb = document.getElementById('empList');
    tb.innerHTML = '';
    list.forEach(u => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${u.userId}</td>
        <td>${u.name}</td>
        <td>${u.role}</td>
        <td>
          <button class="btn-flat red-text" onclick="deleteEmployee('${u.userId}')">
            ì‚­ì œ
          </button>
        </td>`;
      tb.appendChild(tr);
    });
  }

  // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
  // ì„œë²„ì—ì„œ ì§ì› ëª©ë¡ì„ ê°€ì ¸ì™€ UI ê°±ì‹ 
  function loadEmployees() {
    google.script.run
      .withSuccessHandler(updateEmployeeUI)
      .getEmployees();
  }

  // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
  // ì§ì› ì¶”ê°€ í¼ í•¸ë“¤ëŸ¬
  document.getElementById('addForm').addEventListener('submit', e => {
    e.preventDefault();
    const id = document.getElementById('newId').value.trim();
    const nm = document.getElementById('newName').value.trim();
    const pw = document.getElementById('newPw').value;
    const rl = document.getElementById('newRole').value;

    google.script.run
      .withSuccessHandler(() => {
        M.toast({ html: 'ì§ì› ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤' });
        // ì¶”ê°€ ì„±ê³µ í›„ ìµœì‹  ëª©ë¡ìœ¼ë¡œ UI ì „ì²´ ê°±ì‹ 
        loadEmployees();
        // í¼ ì´ˆê¸°í™”
        document.getElementById('newId').value = '';
        document.getElementById('newName').value = '';
        document.getElementById('newPw').value = '';
        document.getElementById('newRole').selectedIndex = 0;
        M.updateTextFields();
      })
      .withFailureHandler(err => {
        M.toast({ html: err.message });
      })
      .addEmployee(id, nm, pw, rl);
  });

  // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
  // ì§ì› ì‚­ì œ í•¨ìˆ˜
  function deleteEmployee(userId) {
    if (!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
    google.script.run
      .withSuccessHandler(() => {
        M.toast({ html: 'ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤' });
        // ì‚­ì œ í›„ ìµœì‹  ëª©ë¡ìœ¼ë¡œ UI ì „ì²´ ê°±ì‹ 
        loadEmployees();
      })
      .withFailureHandler(err => {
        M.toast({ html: err.message });
      })
      .deleteEmployee(userId);
  }

  // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
  // í˜ì´ì§€ ë¡œë“œ ì‹œ ìµœì´ˆ 1íšŒ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
  document.addEventListener('DOMContentLoaded', () => {
    loadEmployees();
  });

    
function loadCurrentCutoff() {
  const d = document.getElementById('cutoffDate').value;
  google.script.run
    .withSuccessHandler(t => {
      document.getElementById('currentCutoff').textContent =
        t ? `í˜„ì¬ ë§ˆê°: ${t}` : 'ë¯¸ì„¤ì • (ê¸°ë³¸ 10:30)';
    })
    .getCutoffTime(d);
}

  </script>

</body>
</html>
